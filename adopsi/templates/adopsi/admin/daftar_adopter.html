{% extends 'adopsi/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}Daftar Adopter - Admin SIZOPI{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex items-center space-x-3 mb-8">
        <a href="{% url 'adopsi:admin_dashboard' %}" class="text-blue-600 hover:text-blue-800 text-sm flex items-center">
            <i class="fas fa-arrow-left mr-1"></i> Kembali ke Dashboard
        </a>
        <h1 class="text-2xl lg:text-3xl font-bold text-gray-900">Daftar Adopter</h1>
    </div>
    
    <!-- Search Box -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
        <form method="get" class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4">
            <div class="flex-grow">
                <label for="search" class="sr-only">Cari Adopter</label>
                <div class="relative rounded-md shadow-sm">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                    <input type="text" name="search" id="search" value="{{ search_query|default:'' }}" class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500" placeholder="Cari berdasarkan nama...">
                </div>
            </div>
            
            <button type="submit" class="w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md px-4 py-2 transition">
                <i class="fas fa-search mr-2"></i>Cari
            </button>
        </form>
    </div>
    
    <!-- TABS NAVIGATION -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden mb-8">
        <!-- Tab Headers -->
        <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
                <button onclick="switchTab('organisasi')" id="tab-organisasi" 
                        class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors
                               border-purple-500 text-purple-600 bg-purple-50">
                    <i class="fas fa-building mr-2"></i>
                    Organisasi
                    <span id="count-organisasi" class="ml-2 bg-purple-100 text-purple-800 py-0.5 px-2 rounded-full text-xs font-medium">
                        0
                    </span>
                </button>
                <button onclick="switchTab('individu')" id="tab-individu"
                        class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors
                               border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    <i class="fas fa-user mr-2"></i>
                    Individu
                    <span id="count-individu" class="ml-2 bg-gray-100 text-gray-800 py-0.5 px-2 rounded-full text-xs font-medium">
                        0
                    </span>
                </button>
                <button onclick="switchTab('all')" id="tab-all"
                        class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors
                               border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    <i class="fas fa-users mr-2"></i>
                    Semua
                    <span id="count-all" class="ml-2 bg-gray-100 text-gray-800 py-0.5 px-2 rounded-full text-xs font-medium">
                        {{ adopters.paginator.count }}
                    </span>
                </button>
            </nav>
        </div>
        
        <!-- Tab Content -->
        <div class="tab-content">
            <!-- ORGANISASI TAB -->
            <div id="content-organisasi" class="tab-panel">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-purple-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">
                                    <i class="fas fa-building mr-1"></i> Organisasi
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">
                                    NPP
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">
                                    Total Kontribusi
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-purple-700 uppercase tracking-wider">
                                    Status
                                </th>
                                <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-purple-700 uppercase tracking-wider">
                                    Riwayat Adopsi
                                </th>
                                <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-purple-700 uppercase tracking-wider">
                                    Aksi
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="organisasi-tbody">
                            <!-- ORGANISASI CONTENT FROM DJANGO -->
                            {% for adopter in adopters.object_list %}
                            {% if adopter.type == 'organisasi' %}
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center">
                                            <i class="fas fa-building text-purple-500"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="text-sm font-bold text-gray-900">{{ adopter.nama|default:"Unknown" }}</div>
                                            <div class="text-xs text-gray-500">{{ adopter.username_adopter }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ adopter.identifier|default:"-" }}</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-bold text-gray-900">Rp{{ adopter.total_kontribusi|floatformat:0|intcomma }}</div>
                                    <div class="text-xs text-gray-500">
                                        {% if adopter.total_kontribusi > 0 %}Adopsi lunas{% else %}Belum ada kontribusi{% endif %}
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if adopter.is_active %}
                                        <span class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                            <i class="fas fa-circle text-green-400 mr-1" style="font-size: 6px;"></i>Aktif
                                        </span>
                                    {% else %}
                                        <span class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                            <i class="fas fa-circle text-gray-400 mr-1" style="font-size: 6px;"></i>Tidak Aktif
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-center">
                                    <a href="{% url 'adopsi:admin_detail_adopter_typed' adopter.id_adopter adopter.type %}" 
                                       class="inline-flex items-center px-3 py-1 border border-purple-300 rounded-md text-sm text-purple-600 bg-purple-50 hover:bg-purple-100 transition">
                                        <i class="fas fa-list mr-1"></i>Lihat Detail
                                    </a>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-center">
                                    {% if adopter.is_active %}
                                        <span class="inline-flex items-center px-3 py-1 bg-gray-100 text-gray-400 rounded-md text-sm cursor-not-allowed">
                                            <i class="fas fa-lock mr-1"></i>Terkunci
                                        </span>
                                    {% else %}
                                        <button type="button" 
                                                class="inline-flex items-center px-3 py-1 border border-red-300 rounded-md text-sm text-red-600 bg-red-50 hover:bg-red-100 transition show-modal" 
                                                data-modal-target="deleteModal-{{ adopter.id_adopter }}-{{ adopter.type }}">
                                            <i class="fas fa-trash mr-1"></i>Hapus
                                        </button>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                            
                            <!-- NO ORGANISASI MESSAGE -->
                            <tr id="no-organisasi" class="hidden">
                                <td colspan="6" class="px-6 py-12 text-center">
                                    <div class="text-gray-400">
                                        <i class="fas fa-building text-4xl mb-4 block"></i>
                                        <p class="text-lg font-semibold text-gray-600">Belum ada adopter organisasi</p>
                                        <p class="text-sm text-gray-500 mt-1">Data akan muncul setelah ada adopsi baru</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- INDIVIDU TAB -->
            <div id="content-individu" class="tab-panel hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-blue-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">
                                    <i class="fas fa-user mr-1"></i> Individu
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">
                                    NIK
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">
                                    Total Kontribusi
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-blue-700 uppercase tracking-wider">
                                    Status
                                </th>
                                <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-blue-700 uppercase tracking-wider">
                                    Riwayat Adopsi
                                </th>
                                <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-blue-700 uppercase tracking-wider">
                                    Aksi
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="individu-tbody">
                            <!-- INDIVIDU CONTENT FROM DJANGO -->
                            {% for adopter in adopters.object_list %}
                            {% if adopter.type == 'individu' %}
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                                            <i class="fas fa-user text-blue-500"></i>
                                        </div>
                                        <div class="ml-4">
                                            <div class="text-sm font-bold text-gray-900">{{ adopter.nama|default:"Unknown" }}</div>
                                            <div class="text-xs text-gray-500">{{ adopter.username_adopter }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ adopter.identifier|default:"-" }}</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-bold text-gray-900">Rp{{ adopter.total_kontribusi|floatformat:0|intcomma }}</div>
                                    <div class="text-xs text-gray-500">
                                        {% if adopter.total_kontribusi > 0 %}Adopsi lunas{% else %}Belum ada kontribusi{% endif %}
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if adopter.is_active %}
                                        <span class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                            <i class="fas fa-circle text-green-400 mr-1" style="font-size: 6px;"></i>Aktif
                                        </span>
                                    {% else %}
                                        <span class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                            <i class="fas fa-circle text-gray-400 mr-1" style="font-size: 6px;"></i>Tidak Aktif
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-center">
                                    <a href="{% url 'adopsi:admin_detail_adopter_typed' adopter.id_adopter adopter.type %}" 
                                       class="inline-flex items-center px-3 py-1 border border-blue-300 rounded-md text-sm text-blue-600 bg-blue-50 hover:bg-blue-100 transition">
                                        <i class="fas fa-list mr-1"></i>Lihat Detail
                                    </a>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-center">
                                    {% if adopter.is_active %}
                                        <span class="inline-flex items-center px-3 py-1 bg-gray-100 text-gray-400 rounded-md text-sm cursor-not-allowed">
                                            <i class="fas fa-lock mr-1"></i>Terkunci
                                        </span>
                                    {% else %}
                                        <button type="button" 
                                                class="inline-flex items-center px-3 py-1 border border-red-300 rounded-md text-sm text-red-600 bg-red-50 hover:bg-red-100 transition show-modal" 
                                                data-modal-target="deleteModal-{{ adopter.id_adopter }}-{{ adopter.type }}">
                                            <i class="fas fa-trash mr-1"></i>Hapus
                                        </button>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endif %}
                            {% endfor %}
                            
                            <!-- NO INDIVIDU MESSAGE -->
                            <tr id="no-individu" class="hidden">
                                <td colspan="6" class="px-6 py-12 text-center">
                                    <div class="text-gray-400">
                                        <i class="fas fa-user text-4xl mb-4 block"></i>
                                        <p class="text-lg font-semibold text-gray-600">Belum ada adopter individu</p>
                                        <p class="text-sm text-gray-500 mt-1">Data akan muncul setelah ada adopsi baru</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ALL TAB -->
            <div id="content-all" class="tab-panel hidden">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Adopter
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Tipe
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Total Kontribusi
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Status
                                </th>
                                <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Riwayat Adopsi
                                </th>
                                <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Aksi
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="all-tbody">
                            {% for adopter in adopters.object_list %}
                            <tr class="hover:bg-gray-50">
                                <!-- KOLOM ADOPTER -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-10 w-10 rounded-full {% if adopter.type == 'organisasi' %}bg-purple-100{% else %}bg-blue-100{% endif %} flex items-center justify-center">
                                            {% if adopter.type == 'organisasi' %}
                                                <i class="fas fa-building text-purple-500"></i>
                                            {% else %}
                                                <i class="fas fa-user text-blue-500"></i>
                                            {% endif %}
                                        </div>
                                        <div class="ml-4">
                                            <div class="text-sm font-bold text-gray-900">
                                                {{ adopter.nama|default:"Unknown" }}
                                            </div>
                                            <div class="text-xs text-gray-500">
                                                {{ adopter.username_adopter }}
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                
                                <!-- TIPE -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                                        {% if adopter.type == 'organisasi' %}
                                            bg-purple-100 text-purple-800
                                        {% else %}
                                            bg-blue-100 text-blue-800
                                        {% endif %}
                                    ">
                                        {% if adopter.type == 'organisasi' %}
                                            <i class="fas fa-building mr-1"></i>
                                            Organisasi
                                        {% else %}
                                            <i class="fas fa-user mr-1"></i>
                                            Individu
                                        {% endif %}
                                    </span>
                                    <div class="text-xs text-gray-500 mt-1">
                                        {% if adopter.type == 'organisasi' %}NPP{% else %}NIK{% endif %}: {{ adopter.identifier|default:"-" }}
                                    </div>
                                </td>
                                
                                <!-- TOTAL KONTRIBUSI -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm font-bold text-gray-900">
                                        Rp{{ adopter.total_kontribusi|floatformat:0|intcomma }}
                                    </div>
                                    <div class="text-xs text-gray-500">
                                        {% if adopter.total_kontribusi > 0 %}
                                            Adopsi lunas
                                        {% else %}
                                            Belum ada kontribusi
                                        {% endif %}
                                    </div>
                                </td>
                                
                                <!-- STATUS -->
                                <td class="px-6 py-4 whitespace-nowrap">
                                    {% if adopter.is_active %}
                                        <span class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                                            <i class="fas fa-circle text-green-400 mr-1" style="font-size: 6px;"></i>
                                            Aktif
                                        </span>
                                    {% else %}
                                        <span class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                                            <i class="fas fa-circle text-gray-400 mr-1" style="font-size: 6px;"></i>
                                            Tidak Aktif
                                        </span>
                                    {% endif %}
                                </td>
                                
                                <!-- RIWAYAT ADOPSI -->
                                <td class="px-6 py-4 whitespace-nowrap text-center">
                                    <a href="{% url 'adopsi:admin_detail_adopter_typed' adopter.id_adopter adopter.type %}" 
                                       class="inline-flex items-center px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-600 bg-gray-50 hover:bg-gray-100 transition">
                                        <i class="fas fa-list mr-1"></i>
                                        Lihat Detail
                                    </a>
                                </td>
                                
                                <!-- AKSI -->
                                <td class="px-6 py-4 whitespace-nowrap text-center">
                                    {% if adopter.is_active %}
                                        <span class="inline-flex items-center px-3 py-1 bg-gray-100 text-gray-400 rounded-md text-sm cursor-not-allowed">
                                            <i class="fas fa-lock mr-1"></i>
                                            Terkunci
                                        </span>
                                    {% else %}
                                        <button type="button" 
                                                class="inline-flex items-center px-3 py-1 border border-red-300 rounded-md text-sm text-red-600 bg-red-50 hover:bg-red-100 transition show-modal" 
                                                data-modal-target="deleteModal-{{ adopter.id_adopter }}-{{ adopter.type }}">
                                            <i class="fas fa-trash mr-1"></i>
                                            Hapus
                                        </button>
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="px-6 py-12 text-center">
                                    <div class="text-gray-400">
                                        <i class="fas fa-users text-4xl mb-4 block"></i>
                                        <p class="text-lg font-semibold text-gray-600">Belum ada data adopter</p>
                                        <p class="text-sm text-gray-500 mt-1">Data akan muncul setelah ada adopsi baru</p>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Pagination -->
    {% if adopters.paginator.num_pages > 1 %}
    <div class="flex justify-center">
        <nav class="flex items-center space-x-2">
            {% if adopters.has_previous %}
                <a href="?page={{ adopters.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                   class="px-3 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition">
                    <i class="fas fa-chevron-left"></i>
                </a>
            {% else %}
                <span class="px-3 py-2 rounded-md bg-gray-100 text-gray-400 cursor-not-allowed">
                    <i class="fas fa-chevron-left"></i>
                </span>
            {% endif %}
            
            {% for num in adopters.paginator.page_range %}
                {% if adopters.number == num %}
                    <span class="px-3 py-2 rounded-md bg-blue-600 text-white font-semibold">{{ num }}</span>
                {% else %}
                    <a href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                       class="px-3 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition">{{ num }}</a>
                {% endif %}
            {% endfor %}
            
            {% if adopters.has_next %}
                <a href="?page={{ adopters.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}" 
                   class="px-3 py-2 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition">
                    <i class="fas fa-chevron-right"></i>
                </a>
            {% else %}
                <span class="px-3 py-2 rounded-md bg-gray-100 text-gray-400 cursor-not-allowed">
                    <i class="fas fa-chevron-right"></i>
                </span>
            {% endif %}
        </nav>
    </div>
    {% endif %}
</div>

<!-- Modal Konfirmasi Hapus -->
{% for adopter in adopters.object_list %}
{% if not adopter.is_active %}
<div id="deleteModal-{{ adopter.id_adopter }}-{{ adopter.type }}" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
    <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md">
        <div class="text-center mb-6">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-900">Hapus Adopter {{ adopter.type|title }}?</h3>
        </div>
        
        <div class="text-center mb-6">
            <p class="text-gray-700 mb-4">
                Yakin ingin menghapus adopter <strong>{{ adopter.type }}</strong> 
                "<span class="font-semibold {% if adopter.type == 'organisasi' %}text-purple-600{% else %}text-blue-600{% endif %}">{{ adopter.nama }}</span>"?
            </p>
            <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                <p class="text-red-700 text-sm">
                    <i class="fas fa-exclamation-circle mr-1"></i>
                    <strong>Peringatan:</strong> Ini akan menghapus semua riwayat adopsi untuk tipe {{ adopter.type }} ini, 
                    tetapi tidak akan menghapus akun pengunjung yang terkait.
                </p>
            </div>
        </div>
        
        <div class="flex justify-center space-x-4">
            <button type="button" class="close-modal bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-2 rounded-lg font-medium transition">
                Batal
            </button>
            <a href="{% url 'adopsi:admin_hapus_adopter' adopter.id_adopter adopter.type %}" 
               class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-medium transition">
                Ya, Hapus
            </a>
        </div>
    </div>
</div>
{% endif %}
{% endfor %}

<script>
    // Tab switching functionality
    function switchTab(tabName) {
        // Hide all tab panels
        document.querySelectorAll('.tab-panel').forEach(panel => {
            panel.classList.add('hidden');
        });
        
        // Reset all tab buttons
        document.querySelectorAll('.tab-button').forEach(button => {
            button.className = 'tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300';
        });
        
        // Show selected tab panel
        document.getElementById(`content-${tabName}`).classList.remove('hidden');
        
        // Activate selected tab button
        const activeButton = document.getElementById(`tab-${tabName}`);
        if (tabName === 'organisasi') {
            activeButton.className = 'tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors border-purple-500 text-purple-600 bg-purple-50';
        } else if (tabName === 'individu') {
            activeButton.className = 'tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors border-blue-500 text-blue-600 bg-blue-50';
        } else {
            activeButton.className = 'tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors border-green-500 text-green-600 bg-green-50';
        }
        
        // Show/hide empty state messages
        checkEmptyStates(tabName);
    }
    
    // Check and show empty state messages
    function checkEmptyStates(tabName) {
        if (tabName === 'organisasi') {
            const orgRows = document.querySelectorAll('#organisasi-tbody tr:not(#no-organisasi)');
            const noOrgMessage = document.getElementById('no-organisasi');
            
            if (orgRows.length === 0) {
                noOrgMessage.classList.remove('hidden');
            } else {
                noOrgMessage.classList.add('hidden');
            }
        } else if (tabName === 'individu') {
            const indRows = document.querySelectorAll('#individu-tbody tr:not(#no-individu)');
            const noIndMessage = document.getElementById('no-individu');
            
            if (indRows.length === 0) {
                noIndMessage.classList.remove('hidden');
            } else {
                noIndMessage.classList.add('hidden');
            }
        }
    }
    
    // Count adopters by type
    function updateCounts() {
        // Count organisasi rows (exclude hidden message row)
        const orgRows = document.querySelectorAll('#organisasi-tbody tr:not(#no-organisasi):not(.hidden)');
        const orgCount = orgRows.length;
        document.getElementById('count-organisasi').textContent = orgCount;
        
        // Count individu rows (exclude hidden message row)  
        const indRows = document.querySelectorAll('#individu-tbody tr:not(#no-individu):not(.hidden)');
        const indCount = indRows.length;
        document.getElementById('count-individu').textContent = indCount;
        
        // Update tab button colors based on counts
        const orgCountSpan = document.getElementById('count-organisasi');
        const indCountSpan = document.getElementById('count-individu');
        
        if (orgCount > 0) {
            orgCountSpan.className = 'ml-2 bg-purple-100 text-purple-800 py-0.5 px-2 rounded-full text-xs font-medium';
        } else {
            orgCountSpan.className = 'ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs font-medium';
        }
        
        if (indCount > 0) {
            indCountSpan.className = 'ml-2 bg-blue-100 text-blue-800 py-0.5 px-2 rounded-full text-xs font-medium';
        } else {
            indCountSpan.className = 'ml-2 bg-gray-100 text-gray-600 py-0.5 px-2 rounded-full text-xs font-medium';
        }
    }
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function () {
        // Update counts on page load
        updateCounts();
        
        // Check empty states for initial tab
        checkEmptyStates('organisasi');
        
        // Modal functionality
        document.addEventListener('click', function(e) {
            // Handle show modal
            if (e.target.classList.contains('show-modal') || e.target.closest('.show-modal')) {
                const button = e.target.classList.contains('show-modal') ? e.target : e.target.closest('.show-modal');
                const modalTarget = button.getAttribute('data-modal-target');
                const modal = document.getElementById(modalTarget);
                if (modal) {
                    modal.classList.remove('hidden');
                } else {
                    console.error('Modal not found:', modalTarget);
                }
            }
            
            // Handle close modal
            if (e.target.classList.contains('close-modal')) {
                e.target.closest('.modal-overlay').classList.add('hidden');
            }
            
            // Handle click outside modal
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.add('hidden');
            }
        });
        
        // Handle search form submission to maintain tab state
        const searchForm = document.querySelector('form');
        if (searchForm) {
            searchForm.addEventListener('submit', function() {
                // You can add logic here to remember which tab was active
                // For now, it will default back to organisasi tab after search
            });
        }
    });
</script>

<style>
    .modal-overlay {
        background-color: rgba(0, 0, 0, 0.5);
    }
    
    .tab-panel {
        min-height: 400px;
    }
    
    .tab-button {
        transition: all 0.2s ease-in-out;
    }
    
    .tab-button:hover {
        transform: translateY(-1px);
    }
    
    /* Smooth transitions for tab content */
    .tab-panel {
        opacity: 1;
        transition: opacity 0.2s ease-in-out;
    }
    
    .tab-panel.hidden {
        opacity: 0;
    }
    
    /* Make sure tables are responsive */
    @media (max-width: 768px) {
        .tab-button {
            padding: 12px 8px;
            font-size: 12px;
        }
        
        .tab-button i {
            display: none;
        }
    }
</style>
{% endblock %}